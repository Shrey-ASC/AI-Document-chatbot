<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Document Chat</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    margin: 0;
    padding: 20px;
}

.container {
    max-width: 800px;
    margin: auto;
}

.card {
    background: white;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

h2 {
    margin-top: 0;
}

textarea {
    width: 100%;
    height: 120px;
    padding: 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
}

button {
    padding: 10px 20px;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 10px;
    margin-right: 8px;
}

button:hover {
    background: #1e4fd6;
}

.output {
    white-space: pre-wrap;
    background: #f1f5f9;
    padding: 15px;
    border-radius: 4px;
    margin-top: 10px;
    min-height: 60px;
}

.status {
    font-size: 14px;
    margin-top: 5px;
    color: #555;
}
</style>
</head>

<body>

<div class="container">

    <!-- Upload -->
    <div class="card">
        <h2>Upload Document</h2>
        <input type="file" id="file">
        <br>
        <button onclick="upload()">Upload</button>
        <div class="status" id="uploadStatus"></div>
    </div>

    <!-- Ask -->
    <div class="card">
        <h2>Ask a Question</h2>
        <textarea id="q" placeholder="Ask something from the document..."></textarea>
        <br>
        <button onclick="ask()">Ask</button>
        <button onclick="summarize()">Generate Summary</button>
        <div class="output" id="answer"></div>
    </div>

</div>

<script>
const BACKEND_URL = "https://ai-document-backend-f3vv.onrender.com"; 

function upload(){
    const f = document.getElementById('file').files[0];
    if(!f){
        alert("Please select a file");
        return;
    }

    const form = new FormData();
    form.append('file', f);

    uploadStatus.innerText = "Uploading...";

    fetch(`${BACKEND_URL}/upload-document`, {
        method: 'POST',
        body: form
    })
    .then(r => r.json())
    .then(d => uploadStatus.innerText = d.message)
    .catch(() => uploadStatus.innerText = "Upload failed");
}

function ask(){
    answer.innerText = "Thinking...";

    fetch(`${BACKEND_URL}/chat`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({ question: q.value })
    })
    .then(r => r.json())
    .then(d => answer.innerText = d.answer)
    .catch(() => answer.innerText = "Error getting response");
}

function summarize(){
    answer.innerText = "Generating summary...";

    fetch(`${BACKEND_URL}/summarize-document`, {
        method: 'POST'
    })
    .then(async r => {
        const data = await r.json();

        // Handle backend error properly
        if (!r.ok) {
            answer.innerText = data.detail || "Summary failed";
            return;
        }

        // Handle success
        if (data.summary) {
            answer.innerText = data.summary;
        } else {
            answer.innerText = "No summary returned";
        }
    })
    .catch(err => {
        console.error(err);
        answer.innerText = "Error generating summary";
    });
}
</script>

</body>
</html>
